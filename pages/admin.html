<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#ffffff">
  <title>Admin</title>
  <link rel="stylesheet" href="../css/styles.css">
  <link rel="manifest" href="../manifest.json">
</head>

<body>

  <header class="app-header">
    <div class="user-info">
      <h3>Panel Admin</h3>
    </div>
    <button class="btn btn-logout" onclick="logout()">Salir</button>
  </header>

  <main class="main-content">
    <div class="container">

      <div class="section-header">
        <div class="section-header-content">
          <div class="section-icon">ðŸ“Š</div>
          <div>
            <h2 class="section-title-main">GestiÃ³n</h2>
            <p class="section-desc">AdministraciÃ³n de solicitudes y usuarios</p>
          </div>
        </div>
      </div>

      <div class="quick-actions">
        <button class="btn btn-primary" onclick="descargarPDF()" style="width: 100%; margin-bottom: 2rem;">
          ðŸ“„ Descargar Reporte PDF
        </button>
      </div>

      <div class="card">
        <div class="card-header">
          <div class="card-title">Solicitudes Recientes</div>
        </div>
        <ul id="lista" style="list-style: none; padding: 0;"></ul>
      </div>

      <div class="card">
        <div class="card-header">
          <div class="card-title">Crear Nuevo Usuario</div>
        </div>
        <div class="card-body">
          <div class="form-group">
            <label>Usuario</label>
            <input id="u" placeholder="Ej: jpererez">
          </div>
          <div class="form-group">
            <label>ContraseÃ±a</label>
            <input id="p" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢" type="password">
          </div>
          <div class="form-group">
            <label>Nombre Completo</label>
            <input id="n" placeholder="Juan PÃ©rez">
          </div>
          <div class="form-group">
            <label>Rol</label>
            <select id="r"
              style="width: 100%; padding: 14px 16px; border-radius: 12px; border: 2px solid #E2E8F0; background: #F8FAFC; font-size: 1rem;">
              <option value="cliente">Cliente</option>
              <option value="admin">Admin</option>
            </select>
          </div>
          <button class="btn btn-primary" onclick="crearUser()">Crear Usuario</button>
        </div>
      </div>

    </div>
  </main>

  <script src="../app.js"></script>
  <script>
    checkAuth("admin");

    async function cargar() {
      const data = await obtenerTodasLasSolicitudes();
      const ul = document.getElementById("lista");
      ul.innerHTML = "";
      data.forEach(s => {
        const statusClass = s.estado.toLowerCase();
        ul.innerHTML += `
        <li>
            <div style="flex:1">
                <span class="profile-value">${s.motivo}</span>
                <br>
                <small style="color: var(--text-muted)">$${s.monto}</small>
            </div>
            <div style="display:flex; gap:8px; align-items:center">
                 <span class="status ${statusClass}" style="margin-right: 8px">${s.estado}</span>
                 ${s.estado === 'pendiente' ? `
                    <div style="display:flex; gap:4px">
                        <button onclick="actualizarEstadoSolicitud(${s.id}, 'aprobado')" class="btn btn-success" style="padding: 6px 10px; min-height: 32px; font-size: 1.2rem">âœ“</button>
                        <button onclick="actualizarEstadoSolicitud(${s.id}, 'rechazado')" class="btn btn-danger" style="padding: 6px 10px; min-height: 32px; font-size: 1.2rem">Ã—</button>
                    </div>
                 ` : ''}
            </div>
        </li>`;
      });
    }

    async function crearUser() {
      await crearUsuario(
        document.getElementById("u").value,
        document.getElementById("p").value,
        document.getElementById("n").value,
        document.getElementById("r").value
      );
    }

    cargar();
  </script>

</body>

</html>